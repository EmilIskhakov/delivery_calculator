<script>
    // Функция для форматирования чисел
    function formatNumber(value) {
        return value != null && typeof value === 'number' ? value.toFixed(2) : 'N/A';
    }

    // Функция для создания таблицы с результатами
    function createResultsTable(data) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = ''; // Очищаем предыдущие результаты

        const packagingTypes = ["Мешок", "Картонные уголки", "Деревянный каркас"];
        packagingTypes.forEach(type => {
            const resultData = data[type.toLowerCase()];
            if (!resultData) return;

            const table = document.createElement('table');

            // Заголовок таблицы
            const caption = document.createElement('caption');
            caption.textContent = `${type} | Быстрое авто | Обычное авто`;
            table.appendChild(caption);

            // Создание заголовков
            const headerRow = document.createElement('tr');
            const headerCell = document.createElement('th');
            headerCell.textContent = "";
            headerRow.appendChild(headerCell);
            const fastHeader = document.createElement('th');
            fastHeader.textContent = "Быстрое";
            headerRow.appendChild(fastHeader);
            const regularHeader = document.createElement('th');
            regularHeader.textContent = "Обычное";
            headerRow.appendChild(regularHeader);
            table.appendChild(headerRow);

            // Строки таблицы
            const rows = [
                { label: "Вес с упаковкой", fast: resultData.packedWeight, regular: resultData.packedWeight },
                { label: "Стоимость доставки", fast: resultData.fastAutoCost, regular: resultData.regularAutoCost },
                { label: "Упаковка", fast: resultData.packagingCost, regular: resultData.packagingCost },
                { label: "Разгрузочные работы", fast: resultData.unloadCost, regular: resultData.unloadCost },
                { label: "Страховка", fast: resultData.insurance, regular: resultData.insurance },
                { label: "Итого", fast: resultData.totalFast, regular: resultData.totalRegular }
            ];

            // Создание строк
            rows.forEach(row => {
                const rowElement = document.createElement('tr');
                const labelCell = document.createElement('td');
                labelCell.textContent = row.label;
                rowElement.appendChild(labelCell);

                const fastCell = document.createElement('td');
                fastCell.textContent = `$${formatNumber(row.fast)}`;
                rowElement.appendChild(fastCell);

                const regularCell = document.createElement('td');
                regularCell.textContent = `$${formatNumber(row.regular)}`;
                rowElement.appendChild(regularCell);

                table.appendChild(rowElement);
            });

            resultsDiv.appendChild(table);
        });
    }

    // Проверяем наличие данных в URL
    const urlParams = new URLSearchParams(window.location.search);
    const resultsParam = urlParams.get('results');

    if (!resultsParam) {
        alert("Ошибка: данные не найдены!");
        return;
    }

    try {
        const results = JSON.parse(decodeURIComponent(resultsParam));
        if (!results || typeof results !== 'object') {
            alert("Ошибка: некорректные данные!");
            return;
        }
        createResultsTable(results);
    } catch (error) {
        console.error('Ошибка при парсинге данных:', error);
        alert("Произошла ошибка при обработке результатов!");
    }
</script>
