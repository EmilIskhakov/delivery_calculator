<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результат расчета доставки</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f8f8f8;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .button-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .button {
            background-color: #E74C3C;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #C0392B;
        }
    </style>
</head>
<body>
    <h1>Результат расчета доставки</h1>
    <!-- Общая информация -->
    <div class="section">
        <h2>Общая введенная информация</h2>
        <p><strong>Вес товара:</strong> <span id="weight">0</span> кг</p>
        <p><strong>Плотность:</strong> <span id="density">0</span></p>
        <p><strong>Стоимость товара:</strong> $<span id="productCost">0</span></p>
        <p><strong>Страховка (%):</strong> <span id="insuranceRate">0</span></p>
        <p><strong>Страховка (сумма):</strong> $<span id="insuranceAmount">0</span></p>
    </div>
    <!-- Мешок -->
    <div class="section">
        <h2>Мешок</h2>
        <table>
            <thead>
                <tr>
                    <th>Параметр</th>
                    <th>Быстрое авто</th>
                    <th>Обычное авто</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Вес с упаковкой</td>
                    <td id="bagWeightFast">0</td>
                    <td id="bagWeightRegular">0</td>
                </tr>
                <tr>
                    <td>Упаковка</td>
                    <td id="bagPackagingFast">0</td>
                    <td id="bagPackagingRegular">0</td>
                </tr>
                <tr>
                    <td>Разгрузочные работы</td>
                    <td id="bagUnloadFast">0</td>
                    <td id="bagUnloadRegular">0</td>
                </tr>
                <tr>
                    <td><strong>Итого</strong></td>
                    <td id="bagTotalFast">$0.00</td>
                    <td id="bagTotalRegular">$0.00</td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- Картонные уголки -->
    <div class="section">
        <h2>Картонные уголки</h2>
        <table>
            <thead>
                <tr>
                    <th>Параметр</th>
                    <th>Быстрое авто</th>
                    <th>Обычное авто</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Вес с упаковкой</td>
                    <td id="cornersWeightFast">0</td>
                    <td id="cornersWeightRegular">0</td>
                </tr>
                <tr>
                    <td>Упаковка</td>
                    <td id="cornersPackagingFast">0</td>
                    <td id="cornersPackagingRegular">0</td>
                </tr>
                <tr>
                    <td>Разгрузочные работы</td>
                    <td id="cornersUnloadFast">0</td>
                    <td id="cornersUnloadRegular">0</td>
                </tr>
                <tr>
                    <td><strong>Итого</strong></td>
                    <td id="cornersTotalFast">$0.00</td>
                    <td id="cornersTotalRegular">$0.00</td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- Деревянный каркас -->
    <div class="section">
        <h2>Деревянный каркас</h2>
        <table>
            <thead>
                <tr>
                    <th>Параметр</th>
                    <th>Быстрое авто</th>
                    <th>Обычное авто</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Вес с упаковкой</td>
                    <td id="frameWeightFast">0</td>
                    <td id="frameWeightRegular">0</td>
                </tr>
                <tr>
                    <td>Упаковка</td>
                    <td id="framePackagingFast">0</td>
                    <td id="framePackagingRegular">0</td>
                </tr>
                <tr>
                    <td>Разгрузочные работы</td>
                    <td id="frameUnloadFast">0</td>
                    <td id="frameUnloadRegular">0</td>
                </tr>
                <tr>
                    <td><strong>Итого</strong></td>
                    <td id="frameTotalFast">$0.00</td>
                    <td id="frameTotalRegular">$0.00</td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- Кнопки действий -->
    <div class="button-container">
        <button class="button" onclick="goBack()">Вернуться на предыдущую страницу</button>
        <button class="button" onclick="saveCalculation()">Сохранить расчет</button>
    </div>

    <script>
        // Функция для получения данных из URL
        function getResultsFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const resultsParam = urlParams.get('results');
            if (!resultsParam) {
                alert("Ошибка: данные не найдены!");
                return null;
            }
            try {
                const parsedData = JSON.parse(decodeURIComponent(resultsParam));
                console.log("Полученные данные:", parsedData); // Выведите данные в консоль для проверки
                return parsedData;
            } catch (error) {
                console.error('Ошибка при парсинге данных:', error);
                alert("Произошла ошибка при обработке результатов!");
                return null;
            }
        }

        // Функция для заполнения данных
        function fillData(data) {
            if (!data || typeof data !== 'object') {
                alert("Ошибка: некорректные данные!");
                return;
            }
            // Общая информация
            document.getElementById('weight').textContent = data.общаяИнформация?.вес || 0;
            document.getElementById('density').textContent = data.общаяИнформация?.плотность || 0;
            document.getElementById('productCost').textContent = data.общаяИнформация?.стоимостьТовара || 0;
            document.getElementById('insuranceRate').textContent = data.общаяИнформация?.страховкаПроцент || 0;
            document.getElementById('insuranceAmount').textContent = parseFloat(data.общаяИнформация?.страховкаСумма || 0).toFixed(2);

            // Мешок
            document.getElementById('bagWeightFast').textContent = data.мешок?.packedWeight || 0;
            document.getElementById('bagWeightRegular').textContent = data.мешок?.packedWeight || 0;
            document.getElementById('bagPackagingFast').textContent = data.мешок?.packagingCost || 0;
            document.getElementById('bagPackagingRegular').textContent = data.мешок?.packagingCost || 0;
            document.getElementById('bagUnloadFast').textContent = data.мешок?.unloadCost || 0;
            document.getElementById('bagUnloadRegular').textContent = data.мешок?.unloadCost || 0;
            document.getElementById('bagTotalFast').textContent = `$${parseFloat(data.мешок?.totalFast || 0).toFixed(2)}`;
            document.getElementById('bagTotalRegular').textContent = `$${parseFloat(data.мешок?.totalRegular || 0).toFixed(2)}`;

            // Картонные уголки
            document.getElementById('cornersWeightFast').textContent = data.углы?.packedWeight || 0;
            document.getElementById('cornersWeightRegular').textContent = data.углы?.packedWeight || 0;
            document.getElementById('cornersPackagingFast').textContent = data.углы?.packagingCost || 0;
            document.getElementById('cornersPackagingRegular').textContent = data.углы?.packagingCost || 0;
            document.getElementById('cornersUnloadFast').textContent = data.углы?.unloadCost || 0;
            document.getElementById('cornersUnloadRegular').textContent = data.углы?.unloadCost || 0;
            document.getElementById('cornersTotalFast').textContent = `$${parseFloat(data.углы?.totalFast || 0).toFixed(2)}`;
            document.getElementById('cornersTotalRegular').textContent = `$${parseFloat(data.углы?.totalRegular || 0).toFixed(2)}`;

            // Деревянный каркас
            document.getElementById('frameWeightFast').textContent = data.каркас?.packedWeight || 0;
            document.getElementById('frameWeightRegular').textContent = data.каркас?.packedWeight || 0;
            document.getElementById('framePackagingFast').textContent = data.каркас?.packagingCost || 0;
            document.getElementById('framePackagingRegular').textContent = data.каркас?.packagingCost || 0;
            document.getElementById('frameUnloadFast').textContent = data.каркас?.unloadCost || 0;
            document.getElementById('frameUnloadRegular').textContent = data.каркас?.unloadCost || 0;
            document.getElementById('frameTotalFast').textContent = `$${parseFloat(data.каркас?.totalFast || 0).toFixed(2)}`;
            document.getElementById('frameTotalRegular').textContent = `$${parseFloat(data.каркас?.totalRegular || 0).toFixed(2)}`;
        }

        // Функция для возврата на предыдущую страницу
        function goBack() {
            window.history.back();
        }

        // Функция для сохранения расчета
        function saveCalculation() {
            const jsonData = getResultsFromUrl();
            if (jsonData) {
                const jsonString = JSON.stringify(jsonData);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'calculation_results.json';
                a.click();
                URL.revokeObjectURL(url);
                alert("Расчет успешно сохранен!");
            } else {
                alert("Ошибка: данные не найдены!");
            }
        }

        // Получаем и заполняем данные
        const jsonData = getResultsFromUrl();
        if (jsonData) {
            fillData(jsonData);
        } else {
            document.body.innerHTML = "<h1>Ошибка: данные не найдены</h1>";
        }
    </script>
</body>
</html>
