<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результаты расчета доставки</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 {
            color: #E74C3C;
            text-align: center;
            margin-bottom: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .summary {
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .summary p {
            margin: 5px 0;
            font-size: 16px;
        }
        .packaging {
            margin-bottom: 20px;
        }
        .packaging h2 {
            color: #AA4444;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        tfoot td {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Результаты расчета стоимости доставки</h1>
    <div class="container">
        <!-- Верхний блок с основной информацией -->
        <div class="summary">
            <h2>Основная информация:</h2>
            <p><strong>Вес товара:</strong> <span id="weight"></span> кг</p>
            <p><strong>Объем:</strong> <span id="volume"></span> м³</p>
            <p><strong>Плотность:</strong> <span id="density"></span> кг/м³</p>
            <p><strong>Стоимость товара:</strong> <span id="cost"></span> $</p>
            <p><strong>Количество упаковок:</strong> <span id="quantity"></span></p>
        </div>

        <!-- Блоки с упаковками -->
        <div id="packaging-section"></div>
    </div>

    <script>
        // Получаем данные из URL
        const urlParams = new URLSearchParams(window.location.search);
        const resultsParam = urlParams.get('results');

        if (!resultsParam) {
            alert("Данные не найдены!");
            window.location.href = "/delivery_calculator/index.html"; // Возвращаемся на главную страницу
        }

        try {
            // Декодируем JSON-строку
            const results = JSON.parse(decodeURIComponent(resultsParam));

            if (!results || !results.generalInformation) {
                throw new Error("Некорректные данные");
            }

            // Заполняем основную информацию
            document.getElementById("weight").textContent = results.generalInformation.weight.toFixed(2);
            document.getElementById("volume").textContent = results.generalInformation.volume;
            document.getElementById("density").textContent = results.generalInformation.density;
            document.getElementById("cost").textContent = results.generalInformation.productCost;
            document.getElementById("quantity").textContent = results.generalInformation.boxCount;

            // Функция для создания таблицы упаковки
            function createPackagingTable(packagingType, data) {
                const section = document.createElement("div");
                section.classList.add("packaging");

                const title = document.createElement("h2");
                title.textContent = packagingType;
                section.appendChild(title);

                const table = document.createElement("table");

                // Заголовки таблицы
                const headerRow = table.insertRow();
                const headers = ["Показатель", "Обычная доставка", "Быстрая доставка"];
                headers.forEach(headerText => {
                    const th = document.createElement("th");
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });

                // Строки данных
                const rows = [
                    { label: "Вес с упаковкой", value1: parseFloat(data.packedWeight), value2: parseFloat(data.packedWeight) },
                    { label: "Стоимость упаковки", value1: data.packagingCost, value2: data.packagingCost },
                    { label: "Стоимость доставки", value1: parseFloat(data.deliveryCostRegular), value2: parseFloat(data.deliveryCostFast) },
                    { label: "Стоимость разгрузочных работ", value1: data.unloadCost, value2: data.unloadCost },
                    { label: "Стоимость страховки", value1: data.insurance, value2: data.insurance }
                ];

                rows.forEach(rowData => {
                    const row = table.insertRow();
                    const cells = [rowData.label, rowData.value1, rowData.value2];
                    cells.forEach(cellText => {
                        const cell = document.createElement("td");
                        cell.textContent = typeof cellText === "number" ? cellText.toFixed(2) : cellText;
                        row.appendChild(cell);
                    });
                });

                // Итоговая строка
                const footerRow = table.createTFOOT().insertRow();
                const footerCells = ["Итого сумма всех стоимостей выше", parseFloat(data.totalRegular), parseFloat(data.totalFast)];
                footerCells.forEach(cellText => {
                    const cell = document.createElement("td");
                    cell.textContent = typeof cellText === "number" ? cellText.toFixed(2) : cellText;
                    footerRow.appendChild(cell);
                });

                section.appendChild(table);
                return section;
            }

            // Генерация блоков для каждого типа упаковки
            const packagingSection = document.getElementById("packaging-section");
            const packagingTypes = {
                bag: "Мешок",
                corners: "Картонные уголки",
                frame: "Деревянный каркас"
            };

            for (const [key, title] of Object.entries(packagingTypes)) {
                const packagingData = results[key];
                if (packagingData) {
                    const table = createPackagingTable(title, packagingData);
                    packagingSection.appendChild(table);
                }
            }
        } catch (error) {
            alert("Ошибка при обработке данных: " + error.message);
            console.error(error);
        }
    </script>
</body>
</html>
